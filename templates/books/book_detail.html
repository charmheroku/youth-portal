{% extends "base.html" %}
{% block content %}

    <div class="container mt-5">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white text-center py-3">
                <h2 class="fw-bold">{{ book.title }}</h2>
                <p class="mb-0">By <strong>{{ book.author }}</strong></p>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <!-- –û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ -->
                    <div class="col-md-4 text-center">
                        <img src="{{ book.cover.url|default:'/media/covers/default_cover.jpg' }}" 
                            alt="Book Cover" 
                            class="img-fluid rounded shadow-sm"
                            style="max-width: 100%; height: 300px; object-fit: cover;">
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="col-md-8">
                        <h4 class="fw-bold">üìä Voting & Status</h4>
                        <p><strong>Votes:</strong> <span class="badge bg-primary">{{ book.total_votes }}</span></p>

                        {% if request.user.is_authenticated %}
                            {% if book.status == "voting" %}
                                <form action="{% url 'books:toggle_vote' book.pk %}" method="post">
                                    {% csrf_token %}
                                    {% if request.user in book.votes.all %}
                                        <button type="submit" class="btn btn-success">‚úÖ Voted (Remove)</button>
                                    {% else %}
                                        <button type="submit" class="btn btn-outline-primary">üì¢ Vote</button>
                                    {% endif %}
                                </form>
                            {% elif book.status == "reading" %}
                                <p class="text-success"><strong>üìñ Already in Reading</strong></p>
                            {% else %}
                                <p class="text-danger"><strong>‚õî Not available for voting or reading</strong></p>
                            {% endif %}
                        {% endif %}

                        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
                        {% if request.user.is_staff and book.status == "voting" %}
                            <form action="{% url 'books:finalize_voting' book.pk %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-warning mt-2">üì¢ Finalize Voting & Start Group</button>
                            </form>
                        {% endif %}

                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
                        {% if request.user.is_staff %}
                            <div class="mt-3">
                                <a href="{% url 'books:book_update' book.pk %}" class="btn btn-outline-warning me-2">‚úèÔ∏è Edit</a>
                                <a href="{% url 'books:book_delete' book.pk %}" class="btn btn-outline-danger">üóëÔ∏è Delete</a>
                            </div>
                        {% endif %}

                        <div class="mt-4">
                            <a href="{% url 'books:book_list' %}" class="btn btn-outline-secondary">‚¨ÖÔ∏è Back to book list</a>
                        </div>
                    </div>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ -->
                <hr class="my-4">
                <div>
                    <h4 class="fw-bold">üìñ Book Description</h4>
                    <p>{{ book.description }}</p>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
