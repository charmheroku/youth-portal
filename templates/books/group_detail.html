{% extends "base.html" %}
{% block content %}
<h1>Reading Group for {{ group.book.title }}</h1>

<p><strong>Current Book:</strong> {{ group.book.title }} by {{ group.book.author }}</p>
<img src="{{ group.book.cover.url }}" alt="Book Cover" style="max-width: 200px;">

<h2>Participants</h2>
<ul>
  {% for participant in group.participants.all %}
    <li>{{ participant.first_name }} {{ participant.last_name }}</li>
  {% endfor %}
</ul>

{% if request.user.is_authenticated %}
  {% if request.user in group.participants.all %}
    <form action="{% url 'books:leave_group' group.pk %}" method="post">
      {% csrf_token %}
      <button type="submit">Leave Group</button>
    </form>
  {% else %}
    {% if not request.user.reading_groups.exists %}
      <form action="{% url 'books:join_group' group.pk %}" method="post">
        {% csrf_token %}
        <button type="submit">Join Group</button>
      </form>
    {% else %}
      <p>You are already in another reading group.</p>
    {% endif %}
  {% endif %}
{% endif %}

<hr>

<h2>Reading Sprints</h2>

{% include "books/_sprint_list.html" with sprints=group.sprints.all group_id=group.id %}

{% if request.user.is_staff %}
  <a href="{% url 'books:sprint_create' group_id=group.id %}" class="btn btn-primary">
    âž• Add New Sprint
  </a>
{% endif %}

<a href="{% url 'books:group_list' %}">Back to Groups</a>
{% endblock %}
