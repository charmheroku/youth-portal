{% extends "base.html" %}
{% block content %}
<h2>{{ sprint.name }}</h2>
<p><strong>Dates:</strong> {{ sprint.start_date }} - {{ sprint.end_date }}</p>
<p><strong>Chapters:</strong> {{ sprint.chapters }}</p>

{% if request.user in sprint.group.participants.all %}
  {% if sprint_read %}
    <p>You have already completed this sprint! ✔</p>
  {% endif %}
{% endif %}
<h3>Ideas from Participants:</h3>

{% if sprint.ideas.all %}
  {% for idea in sprint.ideas.all %}
    <div style="border:1px solid #ccc; margin:10px; padding:10px;">
      <strong>{{ idea.user.email }}</strong> - {{ idea.title }}
      <p>{{ idea.content }}</p>
      <h4>Comments:</h4>
      <ul>
        {% for comment in idea.comments.all %}
          <li>{{ comment.user.email }}: {{ comment.comment }}</li>
        {% empty %}
          <li>No comments yet.</li>
        {% endfor %}
      </ul>
      <form method="post" action="{% url 'books:idea_comment_add' idea.id %}">
        {% csrf_token %}
        <textarea name="comment" rows="2" cols="50" placeholder="Add a comment..."></textarea>
        <br>
        <button type="submit">Comment</button>
      </form>
    </div>
  {% endfor %}
{% else %}
  <p>No ideas yet.</p>
{% endif %}

{% if not user_has_idea %}
  <a href="{% url 'books:idea_add' sprint.id %}" class="btn btn-success">
    ➕ Add Your Idea
  </a>
{% else %}
  <p><strong>You have already submitted an idea for this sprint.</strong></p>
{% endif %}

{% if request.user.is_staff %}
  <a href="{% url 'books:sprint_update' sprint.id %}">Edit</a> |
  <a href="{% url 'books:sprint_delete' sprint.id %}">Delete</a>
{% endif %}

{% endblock %}
